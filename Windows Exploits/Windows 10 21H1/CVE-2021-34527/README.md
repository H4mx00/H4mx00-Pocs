# PoC for CVE-2021-34527: PrintNightmare Windows Print Spooler Vulnerability

## Overview
CVE-2021-34527, also known as PrintNightmare, is a critical vulnerability in the Windows Print Spooler service. This vulnerability can be exploited by both remote and local attackers to achieve Remote Code Execution (RCE) or elevate privileges on affected systems.

- **CVE ID**: CVE-2021-34527
- **Severity**: Critical
- **Attack Vector**: Local / Remote
- **Exploit Type**: Remote Code Execution, Privilege Escalation
- **Affected Systems**: Various Windows versions, including Windows Server versions and Windows 10 (verify affected versions per Microsoftâ€™s official advisory).

## Requirements
To exploit this vulnerability, an attacker must have network access to the target system (for RCE) or local access (for LPE). Key requirements include:
- Access to the Print Spooler service.
- Ability to execute commands or manipulate the print drivers.
- In some cases, administrative or SYSTEM privileges to execute specific commands.

**Example Video of Vulnerable Environment Setup:**

[POC](CVE-2021-34527.mp4)


## Exploit Steps
### Step 1: Set up the Vulnerable Environment
Ensure the test environment runs a version of Windows with the Print Spooler service enabled and an unpatched version vulnerable to PrintNightmare. The configurations include:
- **OS Version**: Windows 10 **21H1 19043.928**
- **Patch Level**: Ensure the system does not have security updates installed post-July 2021 (KB5005010 mitigates this vulnerability).

### Step 2: Exploitation Steps
1. **Trigger the Vulnerability**: Interact with the Print Spooler service using a crafted script or driver manipulation command.
    - This typically requires invoking `AddPrinterDriverEx` API calls or manipulating registry entries related to print drivers.
2. **Load a Malicious DLL**: Use the Print Spooler service to load a custom, malicious DLL that grants elevated privileges.
3. **Escalate Privileges / Remote Execution**: Execute code as SYSTEM by running commands or processes under the high-privilege context established through the DLL.

## Testing and Validation
1. **Compile and Run the Exploit**:

```bash
   Import-Module CVE-2021-34527.ps1
   Invoke-Nightmare
```
